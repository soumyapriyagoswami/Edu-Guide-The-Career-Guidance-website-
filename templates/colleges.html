{% extends "base.html" %}
{% block content %}
<div class="hero-section text-center text-white py-5 mb-5">
  <h2 class="fw-bold display-6"><i class="fas fa-map-marker-alt"></i> Explore Government Colleges Near You</h2>
  <p class="lead">Find degree programs, cutoffs, facilities, and connect with alumni mentors.</p>
</div>

<div class="container">
  <!-- Search -->
  <div class="row mb-4">
    <div class="col-lg-8 mx-auto">
      <div class="input-group shadow-sm">
        <input type="text" id="searchBox" class="form-control" placeholder="ðŸ”Ž Search colleges by name or location...">
        <button class="btn btn-primary"><i class="fas fa-search"></i></button>
      </div>
    </div>
  </div>

  <!-- Colleges Grid -->
  <div class="row g-4" id="collegeList">
    {% for college in colleges %}
    <div class="col-md-4 college-card">
      <div class="card h-100 shadow-lg border-0 rounded-4 hover-card">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title fw-bold text-primary">{{ college.name }}</h5>
          <p class="card-text"><i class="fas fa-location-dot text-danger"></i> {{ college.location }}</p>
          <p><strong>Programs:</strong> {{ college.programs|join(', ') }}</p>
          <p><strong>Cutoff:</strong> {{ college.cutoff }}</p>
          <p><strong>Facilities:</strong> {{ college.facilities|join(', ') }}</p>
          <div class="mt-auto text-center">
            <button class="btn btn-outline-primary btn-sm alumni-chat-btn mt-2" data-college="{{ college.name }}">
              <i class="fas fa-user-graduate"></i> Chat with Alumni
            </button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Map -->
  <div class="row mt-5">
    <div class="col-12">
      <h3 class="mb-3"><i class="fas fa-map"></i> Map View</h3>
      <div class="map-container shadow-lg rounded-3 overflow-hidden">
        <iframe 
          src="https://www.openstreetmap.org/export/embed.html?bbox=74.72%2C34.02%2C75.05%2C34.18&amp;layer=mapnik" 
          style="border:0; width:100%; height:400px;">
        </iframe>
      </div>
    </div>
  </div>
</div>

<!-- Chat Modal -->
<div class="modal fade" id="alumniChatModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content chat-modal">
      <div class="modal-header">
        <h5 class="modal-title"><i class="fas fa-comments"></i> Alumni Chat â€“ <span id="chatCollegeName"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body chat-body">
        <div id="chatWindow" class="chat-window"></div>
      </div>
      <div class="modal-footer">
        <div class="input-group">
          <input type="text" id="chatInput" class="form-control" placeholder="Type your message...">
          <button class="btn btn-primary" id="sendChat">Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.hero-section {
  background: linear-gradient(135deg, #0d6efd, #6610f2);
  border-radius: 15px;
}
.hover-card {transition:transform 0.3s ease, box-shadow 0.3s ease;}
.hover-card:hover {transform:translateY(-8px) scale(1.02); box-shadow:0 12px 30px rgba(0,0,0,0.2);}
.map-container {height:400px;border-radius:12px;}
#searchBox:focus {border-color:#6610f2;box-shadow:0 0 10px rgba(102,16,242,0.5);}
.chat-modal {background:#1e1e2f;color:white;border-radius:12px;}
.chat-window {max-height:300px;overflow-y:auto;padding:10px;background:#2a2a40;border-radius:8px;}
.chat-bubble {padding:8px 12px;border-radius:20px;margin-bottom:8px;max-width:70%;animation:fadeIn 0.3s ease;}
.chat-bubble.user {background:#0d6efd;color:white;margin-left:auto;text-align:right;}
.chat-bubble.alumni {background:#4caf50;color:white;margin-right:auto;}
@keyframes fadeIn {from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
</style>

<script>
document.addEventListener("DOMContentLoaded", ()=>{
  const searchBox = document.getElementById("searchBox");
  searchBox.addEventListener("keyup",function(){
    let filter = this.value.toLowerCase();
    document.querySelectorAll(".college-card").forEach(card=>{
      card.style.display = card.innerText.toLowerCase().includes(filter) ? "block" : "none";
    });
  });

  const alumniButtons = document.querySelectorAll(".alumni-chat-btn");
  const chatModal = new bootstrap.Modal(document.getElementById("alumniChatModal"));
  const chatCollegeName = document.getElementById("chatCollegeName");
  const chatWindow = document.getElementById("chatWindow");
  const chatInput = document.getElementById("chatInput");
  const sendChat = document.getElementById("sendChat");

  alumniButtons.forEach(btn=>{
    btn.addEventListener("click",()=>{
      const college = btn.dataset.college;
      chatCollegeName.textContent = college;
      chatWindow.innerHTML = `<div class="chat-bubble alumni">ðŸ‘‹ Hi! Iâ€™m an alum from ${college}. Ask me anything!</div>`;
      chatInput.value="";
      chatModal.show();
    });
  });

  function appendMessage(text,sender){
    const bubble=document.createElement("div");
    bubble.className=`chat-bubble ${sender}`;
    bubble.textContent=text;
    chatWindow.appendChild(bubble);
    chatWindow.scrollTop=chatWindow.scrollHeight;
  }

  sendChat.addEventListener("click",()=>{
    const text=chatInput.value.trim();
    if(!text) return;
    appendMessage(text,"user");
    chatInput.value="";
    setTimeout(()=>appendMessage("ðŸ˜Š Great question! Here's a tip: explore internship opportunities early.", "alumni"),800);
  });
  chatInput.addEventListener("keypress",(e)=>{if(e.key==="Enter") sendChat.click();});
});
</script>
{% endblock %}
